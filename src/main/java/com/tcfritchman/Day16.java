package com.tcfritchman;

import com.tcfritchman.common.Vec2;

import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

public class Day16 {

    static String exampleInput = """
            #################
            #...#...#...#..E#
            #.#.#.#.#.#.#.#.#
            #.#.#.#...#...#.#
            #.#.#.#.###.#.#.#
            #...#.#.#.....#.#
            #.#.#.#.#.#####.#
            #.#...#.#.#.....#
            #.#.#####.#.###.#
            #.#.#.......#...#
            #.#.###.#####.###
            #.#.#...#.....#.#
            #.#.#.#####.###.#
            #.#.#.........#.#
            #.#.#.#########.#
            #S#.............#
            #################
            """;

    static String example2 = """
            ###############
            #.......#....E#
            #.#.###.#.###.#
            #.....#.#...#.#
            #.###.#####.#.#
            #.#.#.......#.#
            #.#.#####.###.#
            #...........#.#
            ###.#.#####.#.#
            #...#.....#.#.#
            #.#.#.###.#.#.#
            #.....#...#.#.#
            #.###.#.#.#.#.#
            #S..#.....#...#
            ###############
            """;

    static String realInput = """
            #############################################################################################################################################
            #.......#.....#.....#.........#...........#.....#.............#.......#.#.....#.......#...#.....#.....#.......#.....#.......#.........#....E#
            #.#.###.###.#.#.###.#####.#.###.#.#.#######.###.#.###.#.#######.#.###.#.#.###.#.#.###.#.#.#.#.#.#.###.#.#.#####.###.#.#.###.#.###.#####.#.###
            #.#...#.....#.....................#.#.....#.#...#.....#.#...........#...#...#...#...#.#.#...#.#.#.....#.#.......#...#.....#.#.#.#.......#...#
            #####.###########.#####.#####.#.#.###.###.#.#.#.###.#.#.#.#########.#######.#######.#.#######.#.#.#.###.#########.#####.#.#.#.#.#.#####.#.#.#
            #.....#.....#...#.....#.#...#.#.#.....#.#.....#.#...#...#.....#...#.......#.#.....#.#.........#...#.#...#.#.......#...#...#.#...#.......#...#
            #.#########.#.#.#.#.###.#.#.#.#.#######.#####.###.###.#######.###.#######.#.#.#.#.#.###########.#.#.#.###.#.###.###.#.#.###.###.#.#.###.#.#.#
            #...#.....#.#.#...#.#...#.#.#.#.......#...#.#.......#.......................#.#.#.#.#.........#...#.#.#...#...#.#...#...#.#...#.....#.....#.#
            #.#.###.#.#.#.#####.#.###.#.#.###.###.#.#.#.#.#######.###.#.###.###.###.#.#.#.#.#.#.#.#######.###.#.#.###.###.#.#.#####.#.#.#####.#.#.#.#.#.#
            #.#...#.#.........#.#.#...#.#.......#...#...#.#.........#...#...#.......#.#.#...#.#.#.#.....#...#.#...#.....#.................#.....#...#...#
            #.###.#.###.###.#.#.#.###.#.###.#.#.#######.#.#.#####.#.###.#.#########.#.#.#.#####.#.#.#######.#.#.###.###.#.#.#######.#.###.#.#.#.###.#.###
            #...#.#...#.#.....#...#...#.....#.........#...#...#...#...#...#...#.....#.#...#.....#...#.......#.....................................#.....#
            ###.#.###.###.#.#######.#######.#.###########.###.#.#.###.#####.#.#######.###.#.#######.#.#####.#.#.#####.#.#.#.#.#####.#.#.#.#.#.#.#.#.#.#.#
            #...#...#.........#.........................#...#.#...........#.#.......#.....#...#...#.#.....#.#.#.....#.#.#.#.#...#.#...#.#.#.#...#...#.#.#
            #.#.###.#.#####.#.#######.#.#.###.###.#.#.###.#.#.###.#######.#.#######.#####.###.#.#.#######.#.#.#####.#.#.#.#####.#.#.###.#.#.#.#.###.###.#
            #.#.....#.#.....#.........#.#.....#.#.#.#.......#.........#...#.#.....#.....#...#.#.#...#.....#.#.....#.#.#.#.....#...#.....#...#...#.#.#...#
            #.#.#######.###.#########.#.#######.#.#.#####.#######.###.#.###.#.###.#####.#####.#.###.#.###########.#.#.#.#####.###.#.###.#####.#.#.#.#.#.#
            #.#.#.........#.#.#.......#...#.....#.#.....#.......#...#.#.....#...#.....#.......#.#...#.#.......#...#...#...#.....#.#...#.....#.#...#...#.#
            #.###.#########.#.#.#########.#.#.#.#.#####.#.#####.###.#.#########.#.#.###.#######.#.###.#.#####.#.#####.#####.#####.#.#.###.###.#.#.#.###.#
            #.......#.....#.#...#.......#.#.#.#.#...#...#...#.#...#.#.#...#.....#...#...#.......#.#...#.....#.#.#.#...#.....#.....#.#.#.#.#...#.....#.#.#
            #.#######.###.#.#.###.###.###.###.#####.#.#####.#.###.###.#.###.#.#######.###.#######.###.#####.#.#.#.#.###.#####.#######.#.#.#.#.#.###.#.#.#
            #.#...#...#.#.#.#.#.#...#.#...#...#.....#...#.#.#.........#.....#...........#.......#.#...#...#.#...#.#.#.#.....#.#.....#.#.#.#.#.....#...#.#
            ###.#.#.###.#.#.#.#.#.#.#.#.###.#.#.#######.#.#.###.#############################.###.#.###.#.#.#.###.#.#.#####.#.###.#.#.#.#.#.#.#.#.#.#.#.#
            #...............#.#...#.#.#.....#.#.....#...#.#...#.#...#.......#.....#...........#...#.....#...#.....#.#.....#.......#.#.#.#.#...#.#.#...#.#
            #.#.#############.###.#.#######.#######.#.###.###.###.#.#.#####.#.###.#.#######.###.###.#########.###.#.###.###########.#.#.#.###.###.#.###.#
            #...#.......#.......#.#.....#...#.......#.....#.#...#.#.......#.#.#.#...#.....#.....#...#.#.........#...#...#.....#.......#.....#.#...#.#...#
            #.#.#.#####.#######.#.#.#.#.#.###.#####.#####.#.###.#.#########.#.#.#####.#####.#####.###.#.#########.###.#.#.###.#######.#######.#.#####.###
            #.#...#...#.......#.#.#...#.#.#.#.....#.....#.#...#...#.........#.....#.....#...#...#.....#.#...#...#.#...#.#.#.......#...#...#.............#
            #.#.#####.###.###.#.#.###.#.#.#.#####.#####.#.#.#.###.###.#.#########.#####.#.#.#.###.###.#.#.###.#.#.###.###.#######.#.###.#.#.#####.#.#.#.#
            #...#.......#.#...#.#.#.....#.#...#...#...#.#...#.#.....#.#...#...#.........#.#.....#...#.....#...#.#...#...#...#...........#...#.....#.#...#
            ###.#.#.###.#.#.###.#.#.###.#.###.#.###.#.###.###.#.###.#.###.#.#.#.#########.#####.###.#######.###.###.#.#.###.###################.###.#.#.#
            #...#.#.#.#...#.#...#.#.#.#.#.....#.....#.......#...#.#.#...#...#...#...#...#...#.....#...#.....#.#...#.#.#...#.......#...#.#.......#...#.#.#
            #.#.#.#.#.###.#.#.#####.#.#.#####.#########.###.###.#.#.###.#########.#.#.#.#.#.#.###.###.#.#####.###.#.###.#.#######.#.#.#.#.#.#####.###.###
            #.#...#.#...#.#.#.......#.#...#...#.......#.#.#.#.......#...#.......#.#...#.#.#.#.#.....#.#.#...#...#.#.....#.#...#...#.#.#.#.#...#...#.....#
            #.#.###.#.#.#.#.#######.#.###.#.###.#####.#.#.#.#.###.#.#.#.###.#####.#####.#.#.#.#.#.###.#.#.#.#.#.#.#########.#.#.###.#.#.#.###.#.###.#.#.#
            #...#...#.#.#.#.#.............#.#.......#.#.#...#.....#...#.....#.....#...#.....#...#.....#...#...#...#.........#.#...#...#.....#...#.......#
            ###.#.#####.#.#.#####.#########.#########.#.#.###.#############.#.#####.#.#######.#########.#########.#.#########.#.#.#.#.#######.###.#.#.#.#
            #...#.....#...#.....#...#...#.#.......#...#.#.....#.............#...#.#.#.....#.#.#.......#.........#.#.....#...#.#.#...#.......#.....#...#.#
            #.#.#.#.#.#.#######.#.#.#.#.#.###.###.#.#.#.#######.#########.#.###.#.#.#.###.#.#.#####.#.#######.#.#.#.###.#.###.#.#########.#.#######.#.#.#
            #.....#.#.#...#...#...#...#.....#.......#.#.......#.....#...#.....#.#.#.#.#.#.#.#.......#...#.......#.#...#.#.#...#.#...#...#.#.#...#.......#
            ###.#.###.###.#.#.###.#########.#.#########.#.###.#####.#.#.#######.#.#.#.#.#.#.###########.#.#######.#.###.#.#.###.#.###.#.###.#.#.###.#.###
            #.#...#...#...#.#.......#.......#.#.#...........#.......#.#...#.....#...#.#...#.....#...#...#.#.....#.#.#...#.#.#.#...#...#...#.#.#...#.#...#
            #.#.#.#.###.###.#######.#.#######.#.#.###.#####.#####.###.###.#.#####.###.#.#####.#.###.#.###.#.#####.#.#.###.#.#.###.#.###.#.#.#.###.#.#.#.#
            #.#.#...#...#...#...#.....#...#...#.#...#...........#.#...#.#.#.#.......#.#.......#.....#...#.#.#.....#.#.#...#.#.#...#.#.......#.#.#.......#
            #.#.#.#####.#.###.#.#######.#.#.###.###.###.#######.#.#.###.#.#.#######.#.#####.###.#######.#.#.#.#####.#.#.#.#.#.#.###.#.#######.#.#.#.###.#
            #...#.....#.#.....#.........#...#.....#.#.......#...#.#.#.......#...#...#.....#.#.....#...#.#.#.......#.#.#.#.#.#...#...#.#.......#.#...#...#
            #.###.###.#.#####################.###.#.#.#####.#.###.#.#######.#.#.#####.###.###.###.#.#.#.#.#######.###.#.###.#.#.#.#####.#######.###.#####
            #.#.....#.#.#.........#...#.....#.#...#.#.#.....#...#.....#...#.#.#.#...#...#...#...#...#...#.....#.......#...#.#...#...........#.....#.....#
            #.###.#.#.#.#######.#.#.#.#.#.#.#.#.###.#.#########.#####.#.#.###.#.#.#.###.###.###.#########.###.###########.#.#######.#######.#####.#.###.#
            #.....#...#.....#...#...#.#.#.#...#.#.#.#...........#...#...#.....#...#...#...#.#...#.....#...#.#.....#.......#.#.....#.#.....#...........#.#
            #.###.#########.#.#######.###.#.#.#.#.#.#.###########.#.#################.###.#.#.###.###.#.###.#####.###.#.###.#.###.#.#.###.#######.#.###.#
            #.......#.........#.....#...#.#...#...#.#...#...#.....#...................#...#.#.#...#...#.#.......#...#.#.......#...#.#.#.........#.#.....#
            #.#.###.#.#######.#.###.###.#.#########.###.#.###.#.#######################.###.#.#.#######.###.###.###.#.#.#######.#####.#########.#.#.###.#
            #.#.#.#.#.#.....#.#.#.#...#.............#.#.#.#...#.........#.....#.......#.#.#.#.#.......#...#.#.#.#.#.#.....#...#.......#...#...#.........#
            ###.#.#.#.#.###.#.#.#.###.###.#.#########.#.#.#.#########.#.#.###.#.###.#.#.#.#.#.#######.###.#.#.#.#.#.#######.#.###.#####.#.#.#.###.#.#.#.#
            #...#.#.#.#.#...#.#.#...#.....#...#.....#.#.#.....#...#.....#...#...#...#.#.#.#.#...#...#.#...#.#.#.#...........#.#...#.....#...#...#...#.#.#
            #.###.#.###.#.#####.#.#######.###.#.###.#.#.#.###.#.#.#.#####.#.#####.#.#.#.#.#.###.#.#.#.#.###.#.#.#.#########.#.#####.###########.#.#.#.#.#
            #.........#.........#.......#...#.....#...#.#...#...#.#...#...#...#.#.#...#...#.....#.#...#...#.#...#...#.#.....#...#...#.........#...#.....#
            #.#######.#.#########.#####.###.#.#.#.###.#.#.#.#####.###.#.#.###.#.#.#######.#######.#######.#.#.###.#.#.#.###.###.#.###.#######.###.#.#####
            #.....#...#.#.#.......#...#...#...#.#...#.#...#.......#...#.#.#...#.#.......#.#...#.#.................#...#.#.#.....#.#...#.........#.#.....#
            #.###.#.###.#.#.#########.#.###########.#.#.#######.###.###.###.###.#######.#.#.#.#.#.#######.#######.#####.#.#####.#.###.#.#######.#.#####.#
            #.#.#.#.#...#.#.#.........#.............#.#.......#...#.#.......#.........#.#.#.#.#.....#...#.#.....#.#.....#.#.....#...#.#...#.....#...#.#.#
            #.#.#.#.###.#.#.#.#####.###########.#.###########.#.###.#.###.#.#.#.#####.#.#.#.#.#.#####.#.###.###.###.#####.#.#####.#.#####.#####.#.#.#.#.#
            #...#.#.#...#...#...#...#.........#.#.#...#...#...#.#...#.#.#...#.#.....#.#...#.#.#.#.....#...#...#.....#.......#...#...#...................#
            ###.#.#.#.#.#.#####.#.###.#######.#.###.#.#.#.#.#####.###.#.###.#######.#.#####.#.#.#.#######.#.#.#.#########.###.#.#.###.#.###.#.#####.#.#.#
            #...#.#...#.....#.#.#.....#...#...#.....#...#.#...#...#.#.#.............#.#.....#.#.#.#...#...#.#.....#.....#.....#.#.....#.#...#.......#...#
            #.###.#####.###.#.#.#######.#.#.#.###########.###.#.###.#.#.#########.###.#####.#.#.#.###.#.#######.#.#.###.#######.#####.###.#.#########.###
            #...#.......#.#.#.#...#.....#...#.#.#.....#...#...#...#...#.#.....#.....#.......#...#...#...#.........#.#.#.....#.....#...#...#.#.........#.#
            #####.#####.#.#.#.#.#.#.#########.#.#.###.#.###.#####.#.#.#.#.#####.###.###########.#.#.#.#####.###.###.#.#####.#######.###.###.#.#########.#
            #...#...#...#...#.....#.........#.#...#...#.....#.....#...#.#.#.....#.#.......#.....#.#.......#.#...#...#...#.#...........#.#.....#...#.....#
            #.#.#####.#.#.###.#####.#######.#.#####.###########.#####.#.#.#.#####.#####.###.#####.#.#####.#.###.#.###.#.#.#############.#.#.###.#.#####.#
            #.#.#...#.#.#...#.#...#.....#...#.#...#.............#...#.#.#.#.#.....#...#...#.....#.#.#.....#.......#...#.............#...#.....#.#.......#
            #.#.#.#.#.#.###.###.#.#.#.#.#.###.#.#.#.#########.###.#.#.#.#.#.#####.###.#.#.#####.###.#.#####.#######.#######.#.#######.#####.#.#.#.###.#.#
            #.#...#...#...#.....#.#...#...#.#.#.#.#.#.#...#...#.#.#.....#...#.......#.#.#...........#.....#.#.......#.........#.....#...............#...#
            #.#########.#.#####.#.#.###.#.#.#.#.#.#.#.#.#.#.###.#.#.#####.#.#.###.###.#.#######.#########.#.#####.###.#####.###.###.###.#.#.#####.###.###
            #.#...#.......#.....#...#.#...#...#.#.#.....#...#...#.#.....#.#.#...#.#...#.#.............#.#.#.#...#.#...#...#.#.#.#.#...#.#.....#...#...#.#
            #.#.#.#####.###.#.#######.#####.###.#.#####.#####.#.#.###.#.#.#.#.#.#.#.###.#.#.###.#####.#.#.#.#.#.#.#.###.#.#.#.#.#.###.#.###.#.#.#.#.#.#.#
            #.........#.#...#.............#.#...#.....#...#...#.......#.#.#...#.#.#.#...#.#.........#.#.......#.#.#.#...#.#.#.#.#...#...#...#...#.#...#.#
            #.#.#####.#.#.#####.#########.#.#.#######.###.#.###.#####.###.#.###.#.#.#.###.#.#########.#.#######.#.#.#.###.#.#.#.#.#######.#.#.###.###.#.#
            #...#.#...#.....#...#.......#.#.#...#.....#...#...#.#.#...#...#.#...#.#.#.#...#.................#...#.....#...#...#.#.#...#.......#...#.#...#
            #.###.#.#########.#.###.###.#.#.###.#.#####.#####.#.#.#.###.#####.###.#.###.###.#.#############.###.#.###.#.#######.#.#.#.#.#####.#.#.#.#.#.#
            #.......#.........#...#...#...#...#.#.......#.....#.#.#...#.....#.#...#.....#.#.#.........#...#...#...#...#.#.......#...#...............#...#
            #.#####.#.#.#######.#.###########.#.#########.###.#.#.###.#####.#.#.#########.#.#####.###.###.###.###.#.#.#.#.#######.#.#########.#.#.#.#.###
            #.#.....#.#.......#.#...........#...#...#.......#.#.#...#...#...#.#.#.#.......#...#...#.....#.....#...#.#.#...#.....#...#.........#...#.#.#.#
            #.#.#####.#######.#.###.###.#.#######.#.#.#####.###.#.#.#.#.#.###.#.#.#.#####.###.#.###.###.###.###.###.#.#####.###.###.#.#############.#.#.#
            #.#...#...#.....#...........#.......#.#.#.......#...#.#.#.#.#.....#.#.#.#.#.....#...#.#...#...#.#.....#.#.......#.....#.#.....#.......#.#...#
            #.###.#.#####.#.#####.#######.###.###.#.###.#.#.#.#####.#.###.#.###.#.#.#.#.###.#####.#.#.###.#.#####.#.#########.###.#.#####.#.#####.###.#.#
            #...#.#.....#.#.....#.......#...#.....#...#.#.#.#.#.....#.....#...#.#...#.#.#...#...#...#...#.#.#...#.#...#...#...#.....#...#.#.#...#.....#.#
            ###.#.#####.###.#####.#####.###.#########.#.#.###.#.###.#####.###.#.#.#.#.#.#####.#.#.###.#.#.#.#.#.#.###.#.#.#.###.#######.#.#.#.#.#####.#.#
            #...#...#...#...#.....#...#...#.#...#...#...#...#.#.#...#.........#.#.....#.......#.#.....#...#...#.#...#...#.#.....#.....#.#...#.#.#.....#.#
            #.#####.#.###.###.#####.#.###.#.#.#.#.#.###.###.#.#.#.#####.#######.###############.###.#.###.#####.#####.###.#.#####.###.#.#####.#.#.#####.#
            #.....#.#...#.#...#.....#...#.#.#.#.#.#...#...#.....#.......#.....#.................#...#.....#.#...#.........#...#.#...#...#.....#.#.......#
            #####.#.###.#.#.#.#########.#.#.#.#.#.###.###.#############.#.###.#.###############.#.#####.#.#.#.###.###########.#.#.#.###.#####.###.#.#####
            #.#...#.#...#.#.......#.....#.....#.#...#.#...#.#...#.......#...#.............#...#.#.......#.#.#.....#.....#...#.#...#.#.............#...#.#
            #.#.###.#.#.#.#######.#.#####.#######.#.#.###.#.#.#.#####.#.###.#.###########.###.#.#######.#.#.###.#####.###.#.#.#####.#######.###.#.###.#.#
            #.#.#...#.......#.#...#.#...#...........#...#...#.#.....#.#...#.#...#.......#...#.....#.......#...#.......#...#.#.....#...#.....#...#...#.#.#
            #.#.#.#.#######.#.#.###.#.#.###############.#.###.#####.###.#.#.#.###.###.#####.#######.###.###.#.#.###.###.###.#####.#.#.#######.#####.#.#.#
            #...#...#.......#.#.#.#...#...#.....#...........#.....#.....#.#.#.....#...#.....#...............#.#.#...#...#...#...#.#.#.#...#...#...#.#.#.#
            #######.#.#######.#.#.#.###.#.#.###.#####.#####.#.###.#######.#.#.#.###.###.#####.#############.#.#.#.###.###.#.###.#.#.#.#.#.#.#####.#.#.#.#
            #.......#.......#.#.#.#.#...#.#.#...#...#.....#.....#...#...#.#.#.#...#...#...#...#.#...........#.#.#.....#.#.#.....#.#.#...#.#...#.........#
            #.#####.#######.#.#.#.#.#.###.#.#.###.#.###.#.###.#####.###.#.#.#.#.#.###.###.#.###.#.#.#########.#.#######.#.#######.#.#####.###.#.###.#.#.#
            #.....#...........#.#.#.#.#...#.#.....#.....#.#...#...#...#.#...#...#...#...#...#.....#.......#...#.#.....#.#.........#.....#...#.#.....#...#
            #.###.#.###########.#.#.#.#.###.#############.#.###.#.###.#.#####.#####.###.#############.###.#####.#.###.#.###############.#.###.#.#.#####.#
            #...#...#...........#...#.#.#...#...#.....#...#.....#...#.#...#...#...#...#.........#...#.#...#.....#.#...#.#...........#...#.#...#...#.....#
            ###.###.#.###########.###.#.#.#.#.#.###.#.#.#########.#.#.#.#.###.#.#.###.#.#####.#.#.#.###.#.#.#####.#.###.#.#######.#.#####.#.#.#####.#####
            #.......#.....#.........#.#.#.#...#...#.#.#.....#...#.#.#...#...#.#.#.....#.#...#.#...#...#.#.#.#.....#.#.........#...#.#.....#.#.#.....#...#
            #.#####.#####.#########.#.#.#########.#.#.#####.#.###.#.#######.#.#.#######.#.#.#.#######.#.###.#.#####.###########.###.#.###.#.#.#.#####.#.#
            #.#...#.....#.......#.#.#.#...........#.#.#.....#...#.#.#...#.#...#.......#.#.#.#.....#.......#.#.....#...#.....#...#.#...#...#.#.#.#.....#.#
            #.#.#.#.#.#########.#.#.#.#############.###.#######.#.#.#.#.#.###########.#.#.#.#####.#.#.###.#.#####.###.#.###.#.###.#.#######.#.#.#.#####.#
            #...#.#...#.......#.#...#...#.......#...............#.#...#.#.#.....#...#.#.#.#...#...#.#.....#.......#.#.#.#.....#.....#...#...#.#.#.....#.#
            #.###.#.#.#.#.###.#.#.#####.###.#.###.###########.#.#.#####.#.#.###.#.#.#.###.###.#.###.#####.#######.#.#.#.#######.#####.#.#.###.#.#######.#
            #...#...#.#...#.#...#.....#...#.#...#.#...#.......#.#.#...#...#.#.#.#.#...#...#.....#.....#...#.#.........#...#...#.#...#.#...#...#.........#
            ###.###.#.###.#.#####.#######.#####.#.#.#.#.#####.#.#.#.#.#####.#.#.#.#####.###########.#.#.###.#.###########.#.#.###.#.#.#####.###########.#
            #...#...#...#...#.............#.....#...#.#.#...#.#.#.......#...#.#.#...#...#.........#.#.......#.#.........#...#...#.#...#.....#.....#...#.#
            #####.#.###.#.#.#.###.#########.#####.###.#.#.###.#.#####.#.#.###.#.###.###.#.#######.#.#########.#.#####.#.#######.#.###.#######.#.###.#.#.#
            #.....#.......#.#.#...#.....#.....#...#...#.#...#.#.#...#...#.#...#.....#...#...#...#.#.#.....#...#.#.....#.......#.#...#.#.................#
            #.###.#.###.#.#.#.#.###.###.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#######.#####.#.#.#.#.#.###.#.#.#.#.###########.#.###.###.#############.#.#
            #.#...#.....#...#.#.#.....#.#...#...#.....#.#.#.#.#.#.#...#.#...#.....#...#.....#.#.#.#.#...#...#.....#.........#...#.....#...#.....#...#...#
            #.#########.#.###.#.#.#.#.###.#####.#######.###.#.###.#####.###.###.#.#.###.#####.###.#####.#####.#####.#######.###.#.###.###.#####.#.#.#####
            #.#.....#...#...#.#...#.#.....#...#...#...#.#...#.....#...#.#.#.....#.#.#...#.....#...#...#.#.....#.#.......#.#...#...#.#.#...#...#...#.....#
            #.#.###.#.#.#.###.###.#.#######.#.###.#.#.#.#.#########.###.#.#######.#.#.###.###.#.###.#.#.###.###.#.#####.#.###.###.#.#.#.###.#.#######.###
            #...#.#...#...#...#...#...#.....#...#.#.#.#.#.................#.....#.#.........#.#.....#.#...#.#...#.....#.#.......#.#.#...#...#.......#...#
            #.###.#####.#.#.###.#####.#.#######.###.#.#.#############.#####.###.#.#####.###.#.#######.###.#.#.#.###.#.#.#########.#.#####.#########.###.#
            #.........#.#...#.#...#.#.#.#.....#.....#...#.....#.....#.#.....#...#.....#...#.#...#...#.....#.#.#...#.#.#.#.........#.......#.......#.#...#
            #.#######.#.#####.###.#.#.#.#.#.#####.#####.#.###.#.###.###.#####.#.#####.###.#.###.#.#########.#####.#.#.#.#.#######.#.#.#######.#####.#.###
            #.....#...#.....#...#.#.#.#.#.#.......#...#.#.#.#...#.#.......#...#.#...#.#.#.#.#.....#.....#...#.....#.#.#...#.....#...#.#.....#...........#
            #####.#.###.###.###.#.#.#.#.#.###.#####.#.###.#.#####.#########.#.###.#.#.#.#.#.#######.#.#.#.#.#.###.#.#.#######.#.#.#.###.###.#.#########.#
            #.....#...........#.#.#...#.#.........#.#.....#...........#.....#.#...#...#.#.#.#.......#.#.....#.#...#...........#.#.#...#.#...#...#.......#
            #.###.#.#.###.###.#.#.#.#.#.#######.###.#######.###.###.###.###.#.#.#######.#.#.#.#######.###.###.#######.#########.#.###.#.#.#####.#.#.###.#
            #.#...#...#.#.#.....#.#...#.....#.#.#...#.....#...#.#.#.#...#...#.#.#...#.....#...#.....#.#.....#.......#.....#...#.#.#...................#.#
            #.###.#####.#.#.#####.#.#######.#.#.#.#.#.#.###.###.#.#.#.###.#.#.#.###.#.#####.###.###.#.###.#.#######.#.#.###.#.#.#.#.#.#.###.#.#.###.#.#.#
            #...#...#.....#.#.....#.......#.#...........#...#...#...#.#...#...#.#...#.#.....#.#.#.#...#...#.........#.#...#.#...#...#...#...#...........#
            #.#.###.#.#####.#.###.#########.#####.#.#####.###.#######.#.#######.#.###.#.#####.#.#.#####.#######.#####.###.#.#####.#####.#.###.###.###.#.#
            #.#...#.#.#.....#.#...#.........#.....#.....#.#...#.......#...#...#.#.....#.#.....#.#.........#...#.#...#...#.#.#...#.#...#.#...#.#...#...#.#
            #.###.#.#.###.###.#.###.#######.#.###.#####.#.#.###.#########.#.###.#.#####.#.###.#.#.#######.###.#.#.#.#.#.#.#.#.#.#.#.#.#.###.#.###.#.###.#
            #.#...#.#...#.#...#.#.#...#.....#.........#...#.#...#...#.#.....#...#.#...#.#.#...#.#.....#.#...#...#.#...#...#.#...............#.....#.....#
            #.#.#######.#.#.###.#.###.#####.#########.###.#.#.#.#.#.#.#.#####.###.#.#.#.#.#####.#####.#.###.#.###.###.#.###.#####.#.#.###.#########.#####
            #.#.....#...............#.#...#.#...#.....#.....#.#.#.#.#.....#...#.#...#.#...#...#...#.#...#...#.#...#...#.....#...#.#.#.....#.....#...#...#
            #.###.#.#.#####.#.#####.#.#.#.###.#.#.#####.#.#.#.###.#.#######.###.#####.#####.#.###.#.###.#.#####.#.###.#####.#.#.###.#######.#.###.###.#.#
            #S....#.........#.......#...#.....#.........#...#.....#.........#...............#.....#.....#.....................#.....#.......#.........#.#
            #############################################################################################################################################
            """;

    public static void main(String[] args) {
        System.out.println("Part 1 --- example: " + part1(example2));
        System.out.println("Part 1 --- real: " + part1(realInput));
        System.out.println("Part 2 --- example: " + part2(example2));
        System.out.println("Part 2 --- real: " + part2(realInput));
    }

    private static Object part1(String input) {
        char[][] grid = parseGrid(input);
        int size = grid.length;
        int[][] bestScores = initializeScoreArray(size);

        var start = findChar(grid, 'S');
        return findLowestScore(start, new Vec2(1, 0), grid, new HashMap<>(), bestScores, 0);
    }

    private static Object part2(String input) {
        char[][] grid = parseGrid(input);
        int size = grid.length;
        int[][] bestScores = initializeScoreArray(size);

        var start = findChar(grid, 'S');
        int lowestScore = findLowestScore(start, new Vec2(1, 0), grid, new HashMap<>(), bestScores, 0);

        int lowestScoreTiles = 0;
        for (int row = 0; row < size; row++) {
            for (int col = 0; col < size; col++) {
                if (bestScores[row][col] == lowestScore) {
                    lowestScoreTiles++;
                    System.out.print("X ");
                } else {
                    System.out.print("  ");
                }
            }
            System.out.println();
        }

        return lowestScoreTiles;
    }

    private static int[][] initializeScoreArray(int size) {
        int[][] scores = new int[size][size];
        for (int[] scoresRow : scores) {
            Arrays.fill(scoresRow, Integer.MAX_VALUE);
        }
        return scores;
    }

    private static int findLowestScore(Vec2 position, Vec2 direction, char[][] grid, Map<Vec2, Integer> visited, int[][] bestScores, int score) {
        int lowestScore = Integer.MAX_VALUE;
        var row = position.y();
        var col = position.x();

        if (visited.containsKey(position) && visited.get(position) < score - 1001) {
            return lowestScore;
        }
        visited.put(position, score);

        if (grid[row][col] == 'E') {
            bestScores[row][col] = Math.min(bestScores[row][col], score);
            return score;
        }

        // try straight
        var straight = position.add(direction);
        if (grid[straight.y()][straight.x()] != '#') {
            var straightScore = findLowestScore(straight, direction, grid, visited, bestScores, score + 1);
            lowestScore = Math.min(lowestScore, straightScore);
        }

        // try left
        var leftDir = direction.rotateCounterClockwise();
        var left = position.add(leftDir);
        if (grid[left.y()][left.x()] != '#') {
            var leftScore = findLowestScore(left, leftDir, grid, visited, bestScores, score + 1001);
            lowestScore = Math.min(lowestScore, leftScore);
        }

        // try right
        var rightDir = direction.rotateClockwise();
        var right = position.add(rightDir);
        if (grid[right.y()][right.x()] != '#') {
            var rightScore = findLowestScore(right, rightDir, grid, visited, bestScores, score + 1001);
            lowestScore = Math.min(lowestScore, rightScore);
        }

        bestScores[row][col] = Math.min(bestScores[row][col], lowestScore);
        return lowestScore;
    }

    private static char[][] parseGrid(String input) {
        var lines = input.split("\n");
        var size = lines.length;
        var grid = new char[size][size];
        for (int row = 0; row < size; row++) {
            for (int col = 0; col < size; col++) {
                grid[row][col] = lines[row].charAt(col);
            }
        }
        return grid;
    }

    private static Vec2 findChar(char[][] grid, char character) {
        var size = grid.length;
        for (int row = 0; row < size; row++) {
            for (int col = 0; col < size; col++) {
                if (grid[row][col] == character) {
                    return new Vec2(col, row);
                }
            }
        }
        throw new RuntimeException("Couldn't find the character");
    }
}